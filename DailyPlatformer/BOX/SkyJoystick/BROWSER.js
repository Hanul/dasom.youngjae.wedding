SkyJoystick.AnalogStick=CLASS({preset:()=>{return DIV},params:()=>{return{style:{position:"fixed",left:20,bottom:20,zIndex:999}}},init:(t,e,n)=>{let o=n.img;e.append(o);let i;e.on("touchstart",t=>{let n=e.getLeft()+e.getWidth()/2,o=e.getTop()+e.getHeight()/2,f=RAR(t,t=>{EACH(t.getPositions(),t=>{if(t.left<WIN_WIDTH()/2){let f=180*Math.atan2(t.top-o,t.left-n)/Math.PI;i!==f&&(i=f,e.fireEvent("change"))}})}),u=EVENT("touchmove",t=>{f(t)}),r=EVENT("touchend",()=>{u.remove(),r.remove(),e.fireEvent("touchend")});t.stop()});e.getAngle=(()=>{return i})}}),SkyJoystick.DPad=CLASS({preset:()=>{return DIV},params:()=>{return{style:{position:"fixed",left:20,bottom:20,zIndex:999}}},init:(t,e,n)=>{let o=n.img;e.append(o);let i;e.on("touchstart",t=>{let n=e.getLeft()+e.getWidth()/2,o=e.getTop()+e.getHeight()/2,f=RAR(t,t=>{EACH(t.getPositions(),t=>{if(t.left<WIN_WIDTH()/2){let f=180*Math.atan2(t.top-o,t.left-n)/Math.PI;f>-135&&f<=-45?"up"!==i&&(i="up",e.fireEvent("up")):f>-45&&f<=45?"right"!==i&&(i="right",e.fireEvent("right")):f>45&&f<=135?"down"!==i&&(i="down",e.fireEvent("down")):(f>135&&f<=180||f>=-180&&f<=-135)&&"left"!==i&&(i="left",e.fireEvent("left"))}})}),u=EVENT("touchmove",t=>{f(t)}),r=EVENT("touchend",t=>{u.remove(),r.remove(),i=void 0,e.fireEvent("touchend")});t.stop()})}}),SkyJoystick.DPad45=CLASS({preset:()=>{return DIV},params:()=>{return{style:{position:"fixed",left:20,bottom:20,zIndex:999}}},init:(t,e,n)=>{let o=n.img;e.append(o);let i;e.on("touchstart",t=>{let n=e.getLeft()+e.getWidth()/2,o=e.getTop()+e.getHeight()/2,f=RAR(t,t=>{EACH(t.getPositions(),t=>{t.left<WIN_WIDTH()/2&&(t.left>n?t.top<o?"up"!==i&&(i="up",e.fireEvent("up")):"right"!==i&&(i="right",e.fireEvent("right")):t.top>o?"down"!==i&&(i="down",e.fireEvent("down")):"left"!==i&&(i="left",e.fireEvent("left")))})}),u=EVENT("touchmove",t=>{f(t)}),r=EVENT("touchend",()=>{u.remove(),r.remove(),i=void 0,e.fireEvent("touchend")});t.stop()})}}),SkyJoystick.GamePadController=CLASS(t=>{let e=t.checkIsConnected=(()=>{let t=0;return EACH(navigator.getGamepads(),e=>{e!==TO_DELETE&&(t+=1)}),t>0});return{preset:()=>{return SkyEngine.Node},init:(t,n,o)=>{let i,f=o.onConnected,u=o.onKeydown,r=o.onKeyup,c=o.onChangeStick,g=o.onReleaseStick,h=[],a=[],d=[],l=!1;OVERRIDE(n.step,t=>{i=n.step=(n=>{void 0!==f&&l!==!0&&e()===!0&&(f(),l=!0);let o=navigator.getGamepads(),i=o.length;if(i<h.length){for(let t=i;t<h.length;t+=1){let e=h[t];for(let n=0;n<e.length;n+=1)void 0!==r&&e[n]===!0&&r(t,n)}h.splice(i,h.length-i)}if(i<a.length){for(let t=i;t<a.length;t+=1){let e=a[t];for(let n=0;n<e.length;n+=1)void 0!==g&&e[n]===!0&&g(t,e[n])}a.splice(i,a.length-i)}for(let p=0;p<i;p+=1){let t=o[p],e=h[p];void 0===e&&(h[p]=e=[]);let n=a[p];void 0===n&&(a[p]=n=[]);let i=d[p];if(void 0===i&&(d[p]=i=[]),t!==TO_DELETE){let o=t.buttons;for(let f=0;f<o.length;f+=1){let t=o[f].pressed;void 0!==u&&t===!0&&e[f]!==!0&&u(p,f),void 0!==r&&t!==!0&&e[f]===!0&&r(p,f),e[f]=t}for(let f=o.length;f<e.length;f+=1)void 0!==r&&e[f]===!0&&r(p,f);e.splice(o.length,e.length-o.length);let h=t.axes,a=h.length/2;for(let f=0;f<a;f+=1){let t=f/2,e=h[t],o=h[t+1],u=Math.abs(e)+Math.abs(o)>.5,r=180*Math.atan2(o,e)/Math.PI;void 0!==c&&u===!0&&r!==i[f]&&c(p,f,r),i[f]=r,void 0!==g&&u!==!0&&n[f]===!0&&g(p,f),n[f]=u}for(let f=a;f<n.length;f+=1)void 0!==g&&n[f]===!0&&g(p,f);n.splice(a,n.length-a),i.splice(a,i.length-a)}}t(n)})}),n.appendTo(SkyEngine.Screen.getNonePausableNode())}}}),SkyJoystick.Key=CLASS({preset:()=>{return DIV},init:(t,e,n)=>{let o=n.img,i=n.value;e.append(o),e.on("touchstart",t=>{t.stop()}),e.on("touchend",t=>{t.stop()});e.getValue=(()=>{return i})}}),SkyJoystick.KeySet=CLASS({preset:()=>{return DIV},params:()=>{return{style:{position:"fixed",right:20,bottom:20,zIndex:999}}},init:(t,e,n)=>{let o,i=n.keys;EACH(i,(t,n)=>{t.addStyle({marginLeft:10,marginTop:10,flt:"left"}),t.on("touchstart",n=>{o!==t.getValue()&&(o=t.getValue(),e.fireEvent("change"))}),t.on("touchend",t=>{o=void 0,e.fireEvent("touchend")}),e.append(t),3===i.length&&0===n&&(t.addStyle({flt:"right"}),e.append(CLEAR_BOTH())),4===i.length&&1===n&&e.append(CLEAR_BOTH())}),e.append(CLEAR_BOTH());let f=(e.getValue=(()=>{return o}),t=>{EACH(t.getPositions(),t=>{t.left>WIN_WIDTH()/2&&EACH(i,(n,i)=>{o!==n.getValue()&&t.left>=n.getLeft()&&t.left<=n.getLeft()+n.getWidth()&&t.top>=n.getTop()&&t.top<=n.getTop()+n.getHeight()&&(o=n.getValue(),e.fireEvent("change"))})})});e.on("touchstart",f),e.on("touchmove",f)}}),SkyJoystick.LeftAndRight=CLASS({preset:()=>{return DIV},params:()=>{return{style:{position:"fixed",left:20,bottom:20,zIndex:999}}},init:(t,e,n)=>{let o=n.img;e.append(o);let i;e.on("touchstart",t=>{let n=e.getLeft()+e.getWidth()/2,o=RAR(t,t=>{EACH(t.getPositions(),t=>{t.left<WIN_WIDTH()/2&&(t.left>n?"right"!==i&&(i="right",e.fireEvent("right")):"left"!==i&&(i="left",e.fireEvent("left")))})}),f=EVENT("touchmove",t=>{o(t)}),u=EVENT("touchend",()=>{f.remove(),u.remove(),i=void 0,e.fireEvent("touchend")});t.stop()})}});